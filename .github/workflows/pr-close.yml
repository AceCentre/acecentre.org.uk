name: Close Pull Request

# only trigger on pull request closed events
on:
  pull_request:
    types: [closed]

jobs:
  # Set deployment to inactive when we merge a PR
  PostMerge:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v4
        id: my-script
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const title = context.payload.pull_request.title;
            const deployment_id = title.toLowerCase().replace(/ /g,"-").slice(0,35);

            github.repos.createDeploymentStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              deployment_id,
              state: 'inactive',
              mediaType: {
                previews: ['ant-man-preview']
              }
            });
