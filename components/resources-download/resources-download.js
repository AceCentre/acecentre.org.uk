import { useState } from "react";
import { Radio, RadioGroup } from "../filter-people/filter-people";
import styles from "./resources-download.module.css";

import { Button } from "../button/button";
import config from "../../lib/config";

export const ResourcesDownload = ({ resource }) => {
  const variations = resource.variations || [];
  const downloadableVariations = variations.filter(
    (variation) => variation.instantDownloadAvailable
  );

  if (
    variations.length > 0 &&
    variations.length == downloadableVariations.length
  ) {
    return (
      <AllVariationsDownload resource={resource} variations={variations} />
    );
  }

  return (
    <div className={styles.container}>
      <h1>resources-download -- ResourcesDownload</h1>
      <p>This component is generated by plop</p>
    </div>
  );
};

// If there are multiple variations and they are all downloadable
const AllVariationsDownload = ({ variations }) => {
  const defaultVariation = variations[0];
  const [currentlySelected, setCurrentlySelected] = useState(
    defaultVariation.slug
  );

  const onChange = (value) => {
    console.log("Changed to", value);
    setCurrentlySelected(value);
  };

  const currentlySelectedFull = variations.find(
    (x) => x.slug == currentlySelected
  );

  return (
    <div>
      <p>Choose option:</p>
      <RadioGroup
        className={styles.radioGroup}
        aria-label="Filter staff"
        defaultValue={defaultVariation.slug}
        onChange={onChange}
      >
        {variations.map((variation) => {
          return (
            <Radio
              key={`variation-select-${variation.slug}`}
              value={variation.slug}
            >
              {variation.name}
            </Radio>
          );
        })}
      </RadioGroup>
      <div className={styles.downloadButtonContainer}>
        <Button href={`${config.baseUrl}${currentlySelectedFull.downloadUrl}`}>
          Free download
        </Button>
      </div>
    </div>
  );
};
